<html>
<head>
    <meta charset="utf-8">
    <title>后台管理系统</title>
    <meta name="Keywords" content="网店,品牌网店,精选网购,精选旗舰店">
    <meta name="Description" content="精选品牌网店大全，为您推荐精选网店、精选旗舰店、精选品牌网店、精选全面优惠网购等信息。">
    <link rel="stylesheet" href="/admin/css/manage-system.css">
    <style>

        .nav {
            width: 100%;
            height: 100px;
            background: #0094d2;
            color: white;
            font-size: 16px;
        }

        .nav-logo {
            float: left;
            padding: 10px 20px;
        }

        .nav-logo img {
            width: 100px;
        }

        .nav ul li {
            float: left;
            padding: 40px 20px;
        }

        .nav ul li a {
            color: white;
        }

        .center {
            min-width: 1500px;
        }

        .left-nav {
            width: 181px;
            float: left;
            border: 1px solid #d5d5d5;
            font-size: 14px;
            color: #666;
            min-height: 650px;
            background-color: #fff;
            box-shadow: 0 2px 5px #ccc;
        }

        .left-nav-grade1 {
            width: 100%;
            font-weight: 700;
            height: 41px;
            line-height: 41px;
            text-indent: 20px;
            position: relative;
            background-color: #edf6f9;
            color: #999;
        }

        .left-nav-grade2 {
            text-indent: 35px;
            width: 100%;
            border-bottom: 1px solid #e7e7e7;
            line-height: 40px;
        }

        .nav-bg {
            background: #157fac;
        }

        .center-right {
            float: left;
            margin-left: 60px;
            margin-top: 30px;
        }

        .prod-operation {
            background: #0094d2;
        }

        .prod-operation a {
            color: white;
        }

        .table {
            border: 0;
            cellspacing: 0;
            cellpadding: 0;
            width: 1000px;
        }

        .table td {
            border-bottom: 1px solid #ddd;
            padding-top: 15px;
            padding-bottom: 15px;
            border-top: 1px solid #ddd;
            border-right: 1px solid #ddd;
            font-size: 13px;
        }

        .table-title {
            background-color: #f4f4f4;
            text-align: center;
            border-right: 1px solid #ddd;
            border-top: 1px solid #ddd;
        }

        .table-input {
            width: 450px;
            height: 27px;
            padding-left: 5px;
            margin-left: 20px;
        }

        .btn-group {
            margin-top: 20px;
            margin-bottom: 120px;
            text-align: center;
        }

        #save-btn {
            width: 112px;
            height: 32px;
            background-color: #333;
            color: #fff;
            line-height: 32px;
            text-align: center;
            border-radius: 2px;
            cursor: pointer;
            display: inline-block;
        }

    </style>

    <script type="text/javascript" charset="utf-8" src="ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="ueditor.all.min.js"></script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="lang/zh-cn/zh-cn.js"></script>

    <style type="text/css">
        .clear {
            clear: both;
        }
    </style>
</head>
<body>
<div>
    <div class="nav">
        <div class="nav-logo">
            <img src="/images/logo2.jpg">
            <div>系统管理后台</div>
        </div>
        <ul>
            <li id="prod-manage"><a>商品管理</a></li>
            <li id="shop-manage"><a>店铺管理</a></li>
            <li id="article-manage" class="nav-bg"><a>文章管理</a></li>
            <li id="base-set"><a>基础设置</a></li>
        </ul>
    </div>

    <div class="center">
        <div class="left-nav clearfix">
            <div>
                <div class="left-nav-grade1">文章管理</div>
                <div class="left-nav-grade2">
                    <div class="left-nav-bg">
                        <a href="/admin/articleManage.html">文章列表</a>
                    </div>
                    <div class="left-nav-bg prod-list prod-operation">
                        <a href="/ueditor/articleEnterManage.html">文章录入</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="center-right">
            <table class="table">
                <tbody>
                <tr>
                    <td class="table-title">*标题名称</td>
                    <td colspan="3">
                        <input class="table-input" type="text" name="" id="meta-title" value="">
                    </td>
                <tr>
                    <td class="table-title">*页面关键字</td>
                    <td colspan="3">
                        <input class="table-input" type="text" name="" id="meta-key" value="">
                    </td>
                </tr>
                <tr>
                    <td class="table-title">*文章摘要</td>
                    <td colspan="3">
                        <textarea class="table-input" type="text" name="" id="meta-descp" value=""></textarea>
                    </td>
                </tr>
                <tr>
                    <td class="table-title">所属类型</td>
                    <td colspan="3">
                        <div>
                            <input type="checkbox" name="articleCatalog" value="1">家居装修</input>
                            <input type="checkbox" name="articleCatalog" value="2">选购导购</input>
                            <input type="checkbox" name="articleCatalog" value="3">旅游景点</input>
                            <input type="checkbox" name="articleCatalog" value="4">娱乐趣闻</input>
                            <input type="checkbox" name="articleCatalog" value="5">健康养生</input>
                            <input type="checkbox" name="articleCatalog" value="6">日常生活</input>
                            <input type="checkbox" name="articleCatalog" value="7">母婴育儿</input>
                            <input type="checkbox" name="articleCatalog" value="8">数码科技</input>
                            <input type="checkbox" name="articleCatalog" value="9">游戏资讯</input>
                        </div>
                        <div>
                            <input type="checkbox" name="articleCatalog" value="10">服装鞋包</input>
                            <input type="checkbox" name="articleCatalog" value="11">美妆护肤</input>
                            <input type="checkbox" name="articleCatalog" value="12">城市房产</input>
                            <input type="checkbox" name="articleCatalog" value="13">金融理财</input>
                            <input type="checkbox" name="articleCatalog" value="14">汽车出行</input>
                            <input type="checkbox" name="articleCatalog" value="15">品牌热点</input>
                            <input type="checkbox" name="articleCatalog" value="16">人生指南</input>
                            <input type="checkbox" name="articleCatalog" value="17">美食菜谱</input>
                            <input type="checkbox" name="articleCatalog" value="18">奢侈时尚</input>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="table-title">文章标题</td>
                    <td colspan="3">
                        <input class="table-input" type="text" name="" id="title">
                    </td>
                </tr>
                <tr>
                    <td class="table-title">文章作者</td>
                    <td colspan="3">
                        <input class="table-input" type="text" name="" id="author">
                    </td>
                </tr>
                <tr>
                    <td class="table-title">封面图</td>
                    <td colspan="3">
                        <input class="table-input" type="button" name="" id="picture" value="上传图片">
                    </td>
                </tr>
                <tr>
                    <td class="table-title">文章内容</td>
                    <td colspan="3">
                        <script id="editor" type="text/plain" style="width:1024px;height:500px;"></script>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="btn-group">
                <span id="save-btn" onclick="generatorActicle()">提交</span>
            </div>
        </div>
    </div>
    <!--分页-->
    <div class="page-num"></div>
</div>

<div class="load hidden">
    <div class="loading"></div>
    <img class="loading-img" src="images/loading.gif"/>
</div>
</body>
<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.form.js"></script>
<script src="/js/app.js"></script>
<script src="/js/systemManage.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/app.js"></script>
<script>
    //实例化编辑器
    //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
    UE.getEditor('editor');

    var id = getParam("id");

    function generatorActicle() {
        var param = {};
        param.metaTitle = $("#meta-title").val();
        param.metaKey = $("#meta-key").val();
        param.metaDescp = $("#meta-descp").val();
        param.title = $("#title").val();
        param.picture = $("#picture").val();
        param.author = $("#author").val();
        param.content = UE.getEditor('editor').getContent();

        var type = "";
        $('input[name="articleCatalog"]:checked').each(function () {
            type += $(this).val() + ",";
        });
        type = type.substr(0, type.length - 1);
        param.type = type;

        var contentDescp = UE.getEditor('editor').getContentTxt();
        if (contentDescp.length > 100) {
            contentDescp = contentDescp.substr(0, 95)+".....";
        }
        param.contentDescp = contentDescp;

        if(param.metaTitle==""){
            alert("标题名称不能为空");
            return;
        }
        if(param.metaKey==""){
            alert("页面关键字不能为空");
            return;
        }
        if(param.metaDescp==""){
            alert("文章摘要不能为空");
            return;
        }
        if(type==""){
            alert("所属类型不能为空");
            return;
        }
        if(param.title==""){
            alert("文章标题不能为空");
            return;
        }
        if(param.author==""){
            alert("文章作者不能为空");
            return;
        }
        if(param.content==""){
            alert("文章内容不能为空");
            return;
        }

        app.generatorActicle(param, function (result) {
            if (result.code == 200) {
                alert("添加文章成功");
            }
        })
    }

    $(function () {
        init();
        setTimeout(function () {
            $("#edui1").attr("style", "width: 730px; z-index: 999;");
            $("#edui1_toolbarbox").attr("style", "");
        }, 200);

    });

    function init() {

//        getProduct(1);
        bindEvent();
    }

    function getProduct(page) {
        var reqData = {};
        var param = {};
        param.page = page;
        param.pageSize = 20;
        reqData.reqData = param;

        app.getProductList(reqData, function (result) {
            if (result.code == 200) {
                var html = '';
                var data = result.data.prodList;
                for (var i = 0; i < data.length; i++) {
                    var product = data[i];
                    html += '<div class="content-item">' +
                        '<div class="prod-id">' + product.prodId + '</div>' +
                        '<div class="prod-title">' + product.name + '</div>' +
                        '<div class="cata">' + product.category + '</div>' +
                        '<div class="price">' + product.price + '</div>' +
                        '<div class="sale-price">' + product.discountPrice + '</div>' +
                        '<div class="save-price">' + product.savePrice + '</div>' +
                        '<div class="plate">' + product.platform + '</div>' +
                        '<div class="expire">' + product.expiration + '</div>' +
                        '<div class="operation">' +
                        '<span class="prod-edit"> 编辑 </span>' +
                        '<span class="prod-delete"> 删除 </span>' +
                        '</div>' +
                        '</div>';
                }
                $(".content-list").html(html);

                var totalPage = result.data.totalPage;
                var currPage = result.data.page;

                splitPage(totalPage, currPage, ".page-num",
                    function (index) {
                        if (index != 1) {
                            getProduct(index - 1);
                        }
                    }, function (index) {
                        index = parseInt(index);
                        if (index != totalPage) {
                            getProduct(index + 1);
                        }
                    }, function (index) {
                        getProduct(index);
                    });

                $(".prod-delete").click(function () {
                    var prodId = $(this).parent().parent().find(".prod-id").text();
                    var param = {};
                    param.prodId = prodId;

                    app.deleteProduct(param, function () {
                        if (result.code == 200) {
                            getProduct(page);
                            alert("删除成功");
                        }
                    });
                });
                $(".prod-edit").click(function () {
                    var prodId = $(this).parent().parent().find(".prod-id").text();
                    location.href = "/prodEnterManage.html?id=" + prodId;
                });

            }
        });
    }

    function bindEvent() {
        $(".search-btn").click(function () {
            searchInfo(1);
        });

        $(".more-delete-btn").click(function () {
            var prodId = $("#prod-id-input").val();
            var category = $("#category-input").val();
            var platform = $("#platform-input").val();
            var expirationStart = $("#expiration-start-input").val();
            var expirationEnd = $("#expiration-end-input").val();
            var createTimeStart = $("#createtime-start-input").val();
            var createTimeEnd = $("#createtime-end-input").val();

            if (prodId == "" && category == "" && platform == "" && expirationStart == "" && expirationEnd == ""
                && createTimeStart == "" && createTimeEnd == "") {
                alert("请输入删除条件");
                return;
            }
            $(".load").removeClass("hidden");
            var reqData = {};
            var param = {};
            param.prodId = prodId;
            param.category = category;
            param.platform = platform;
            param.expirationStart = expirationStart;
            param.expirationEnd = expirationEnd;
            param.createTimeStart = createTimeStart;
            param.createTimeEnd = createTimeEnd;
            param.page = 1;
            param.pageSize = 20;
            reqData.reqData = param;

            app.batchProdDelete(reqData, function (result) {
                $(".load").addClass("hidden");
                if (result.code == 200) {
                    searchInfo(1);
                    alert("删除成功");
                }
            });
        });

        $(".all-delete-btn").click(function () {
            $(".load").removeClass("hidden");

            var param = {};
            app.allProdDelete(param, function (result) {
                $(".load").addClass("hidden");
                if (result.code == 200) {
                    searchInfo(1);
                    alert("删除成功");
                }
            });
        });
    }

    function searchInfo(page) {
        var prodId = $("#prod-id-input").val();
        var category = $("#category-input").val();
        var platform = $("#platform-input").val();
        var expirationStart = $("#expiration-start-input").val();
        var expirationEnd = $("#expiration-end-input").val();
        var createTimeStart = $("#createtime-start-input").val();
        var createTimeEnd = $("#createtime-end-input").val();
        var reqData = {};
        var param = {};
        param.prodId = prodId;
        param.category = category;
        param.platform = platform;
        param.expirationStart = expirationStart;
        param.expirationEnd = expirationEnd;
        param.createTimeStart = createTimeStart;
        param.createTimeEnd = createTimeEnd;
        param.page = page;
        param.pageSize = 20;
        reqData.reqData = param;

        $.ajax({
            type: 'post',
            url: "prod/search",
            dataType: 'json',
            contentType: "application/json",
            data: JSON.stringify(reqData),
            success: function (result) {
                if (result.code == 200) {
                    var html = '';
                    var data = result.data.prodList.list;
                    for (var i = 0; i < data.length; i++) {
                        var product = data[i];
                        html += '<div class="content-item">' +
                            '<div class="prod-id">' + product.prodId + '</div>' +
                            '<div class="prod-title">' + product.name + '</div>' +
                            '<div class="cata">' + product.category + '</div>' +
                            '<div class="price">' + product.price + '</div>' +
                            '<div class="sale-price">' + product.discountPrice + '</div>' +
                            '<div class="save-price">' + product.savePrice + '</div>' +
                            '<div class="plate">' + product.platform + '</div>' +
                            '<div class="expire">' + product.expiration + '</div>' +
                            '<div class="operation">' +
                            '<span class="prod-edit"> 编辑 </span>' +
                            '<span class="prod-delete"> 删除 </span>' +
                            '</div>' +
                            '</div>';
                    }
                    $(".content-list").html(html);

                    var totalPage = result.data.totalPage;
                    var currPage = result.data.page;
                    splitPage(totalPage, currPage, ".page-num",
                        function (index) {
                            if (index != 1) {
                                searchInfo(index - 1);
                            }
                        }, function (index) {
                            index = parseInt(index);
                            if (index != totalPage) {
                                searchInfo(index + 1);
                            }
                        }, function (index) {
                            searchInfo(index);
                        });

                    $(".prod-delete").click(function () {
                        var prodId = $(this).parent().parent().find(".prod-id").text();
                        var param = {};
                        param.prodId = prodId;

                        app.deleteProduct(param, function () {
                            if (result.code == 200) {
                                searchInfo(page);
                                alert("删除成功");
                            }
                        });
                    });
                    $(".prod-edit").click(function () {
                        var prodId = $(this).parent().parent().find(".prod-id").text();
                        location.href = "/prodEnterManage.html?id=" + prodId;
                    });
                }
            }
        });
    }

    function splitPage(totalPage, currPage, node, prePage, nextPage, fixPage) {
        var pageNum = "";
        if (totalPage < 10) {
            pageNum += '<span class="pre-page">上一页</span>';
            for (var i = 0; i < totalPage; i++) {
                if ((i + 1) == currPage) {
                    pageNum += '<span id="curr-page" index="' + (i + 1) + '">' + (i + 1) + '</span>';
                } else {
                    pageNum += '<span index="' + (i + 1) + '">' + (i + 1) + '</span>';
                }
            }
            pageNum += '<span class="next-page">下一页</span>';
        } else if (totalPage > 10) {
            if (currPage < 5) {
                pageNum += '<span class="pre-page">上一页</span>';
                for (var i = 0; i < 5; i++) {
                    if ((i + 1) == currPage) {
                        pageNum += '<span id="curr-page" index="' + (i + 1) + '">' + (i + 1) + '</span>';
                    } else {
                        pageNum += '<span index="' + (i + 1) + '">' + (i + 1) + '</span>';
                    }
                }
                pageNum += '<span>...</span>' +
                    '<span index="' + totalPage + '">' + totalPage + '</span>' +
                    '<span class="next-page">下一页</span>';
            } else if (currPage > totalPage - 5) {
                pageNum += '<span class="pre-page">上一页</span><span index="1">1</span><span>...</span>';
                for (var i = totalPage - 5; i < totalPage; i++) {
                    if ((i + 1) == currPage) {
                        pageNum += '<span id="curr-page" index="' + (i + 1) + '">' + (i + 1) + '</span>';
                    } else {
                        pageNum += '<span index="' + (i + 1) + '">' + (i + 1) + '</span>';
                    }
                }
                pageNum += '<span class="next-page">下一页</span>';
            } else {
                pageNum += '<span class="pre-page">上一页</span>' +
                    '<span index="1">1</span>' +
                    '<span>...</span>' +
                    '<span index="' + (currPage - 1) + '">' + (currPage - 1) + '</span>' +
                    '<span id="curr-page" index="' + currPage + '">' + currPage + '</span>' +
                    '<span index="' + (currPage + 1) + '">' + (currPage + 1) + '</span>' +
                    '<span index="' + (currPage + 2) + '">' + (currPage + 2) + '</span>' +
                    '<span>...</span>' +
                    '<span index="' + totalPage + '">' + totalPage + '</span>' +
                    '<span class="next-page">下一页</span>';
            }
        }
        $(node).html(pageNum);
        $(".page-num span").click(function () {
            fixPage($(this).attr("index"));
        });
        $(".pre-page").click(function () {
            prePage($("#curr-page").attr("index"));
        });
        $(".next-page").click(function () {
            nextPage($("#curr-page").attr("index"));
        });
    }
</script>
</html>